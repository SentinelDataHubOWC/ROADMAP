var TIFFPATH='/tiffs',initialized=!1,GDALOpen,GDALClose,GDALGetRasterCount,GDALGetRasterXSize,GDALGetRasterYSize,GDALGetProjectionRef,GDALGetGeoTransform,CPLQuietErrorHandler,CPLSetErrorHandler,CPLGetLastErrorMsg,CPLGetLastErrorNo,CPLGetLastErrorType,CPLErrorReset,Module={print:function(a){console.log('stdout: '+a)},printErr:function(a){console.log('stderr: '+a)},onRuntimeInitialized:function(){Module.ccall('GDALAllRegister',null,[],[]),GDALOpen=Module.cwrap('GDALOpen','number',['string']),GDALClose=Module.cwrap('GDALClose',null,['number']),CPLErrorReset=Module.cwrap('CPLErrorReset',null,[]),CPLSetErrorHandler=Module.cwrap('CPLSetErrorHandler','number',['number']),CPLQuietErrorHandler=Module.cwrap('CPLQuietErrorHandler',null,['number','number','number']);var a=Runtime.addFunction(CPLQuietErrorHandler);CPLGetLastErrorNo=Module.cwrap('CPLGetLastErrorNo','number',[]),CPLGetLastErrorMsg=Module.cwrap('CPLGetLastErrorMsg','string',[]),CPLGetLastErrorType=Module.cwrap('CPLGetLastErrorType','number',[]),GDALGetRasterCount=Module.cwrap('GDALGetRasterCount','number',['number']),GDALGetRasterXSize=Module.cwrap('GDALGetRasterXSize','number',['number']),GDALGetRasterYSize=Module.cwrap('GDALGetRasterYSize','number',['number']),GDALGetProjectionRef=Module.cwrap('GDALGetProjectionRef','string',['number']),GDALGetGeoTransform=Module.cwrap('GDALGetGeoTransform','number',['number','number']),CPLSetErrorHandler(a),FS.mkdir(TIFFPATH),initialized=!0}};setTimeout(function(){Module.onRuntimeInitialized()},5e3),importScripts('gdal.js');function inspectTiff(a){console.warn('hello from worker.js inspectTiff()'),console.log('files: ',a),console.log('FS: ',FS),console.log('WORKERFS: ',WORKERFS),console.log('TIFFPATH: ',TIFFPATH),setTimeout(function(){FS.mount(WORKERFS,{files:a},TIFFPATH);for(var d,b=[],c=0;c<a.length;c++){if(d=GDALOpen(TIFFPATH+'/'+a[c].name),console.warn('!!!!dataset: ',d),0!==CPLGetLastErrorNo()){console.log('Error occurred opening dataset'),console.log('Error message: ',CPLGetLastErrorMsg()),console.log('Error number: ',CPLGetLastErrorNo()),console.log('Resetting errors'),CPLErrorReset();continue}var e=GDALGetRasterCount(d),f=GDALGetRasterXSize(d),g=GDALGetRasterYSize(d);wktStr=GDALGetProjectionRef(d);var h=Module._malloc(6*Float64Array.BYTES_PER_ELEMENT);GDALGetGeoTransform(d,h);var j=Module.HEAPF64.subarray(h/Float64Array.BYTES_PER_ELEMENT,h/Float64Array.BYTES_PER_ELEMENT+6),l=[[0,0],[f,0],[f,g],[0,g]].map(function(m){var n=m[0],o=m[1];return[j[0]+j[1]*n+j[2]*o,j[3]+j[4]*n+j[5]*o]});b.push({bandCount:e,xSize:f,ySize:g,projectionWkt:wktStr,coordinateTransform:j,corners:l}),GDALClose(d)}postMessage(b),FS.unmount(TIFFPATH)},8e3),console.log('//////////////////////////TIFFPATH: ',TIFFPATH)}onmessage=function(a){return console.warn('hello from web worker'),inspectTiff(a.data),initialized?void inspectTiff(a.data):void console.log('Runtime not initialized yet, try again')};
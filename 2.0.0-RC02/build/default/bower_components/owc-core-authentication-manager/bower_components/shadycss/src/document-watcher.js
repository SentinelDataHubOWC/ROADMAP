'use strict';import{nativeShadow}from'./style-settings.js';import StyleTransformer from'./style-transformer.js';import{getIsExtends}from'./style-util.js';export let flush=function(){};function getClasses(a){let b=[];return a.classList?b=Array.from(a.classList):a instanceof window.SVGElement&&a.hasAttribute('class')&&(b=a.getAttribute('class').split(/\s+/)),b}function getCurrentScope(a){let b=getClasses(a),c=b.indexOf(StyleTransformer.SCOPE_NAME);return-1<c?b[c+1]:''}function handler(a){for(let c,b=0;b<a.length;b++)if(c=a[b],c.target!==document.documentElement&&c.target!==document.head)for(let e,d=0;d<c.addedNodes.length;d++)if(e=c.addedNodes[d],e.nodeType===Node.ELEMENT_NODE){e=e;let f=e.getRootNode(),g=getCurrentScope(e);if(g&&f===e.ownerDocument)StyleTransformer.dom(e,g,!0);else if(f.nodeType===Node.DOCUMENT_FRAGMENT_NODE){let h,k=f.host;if(!k)continue;if(h=getIsExtends(k).is,g===h){let l=window.ShadyDOM.nativeMethods.querySelectorAll.call(e,`:not(.${StyleTransformer.SCOPE_NAME})`);for(let m=0;m<l.length;m++)StyleTransformer.element(l[m],g);continue}g&&StyleTransformer.dom(e,g,!0),StyleTransformer.dom(e,h)}}}if(!nativeShadow){let a=new MutationObserver(handler),b=d=>{a.observe(d,{childList:!0,subtree:!0})},c=window.customElements&&!window.customElements.polyfillWrapFlushCallback;if(c)b(document);else{let d=()=>{b(document.body)};window.HTMLImports?window.HTMLImports.whenReady(d):requestAnimationFrame(function(){if('loading'===document.readyState){let e=function(){d(),document.removeEventListener('readystatechange',e)};document.addEventListener('readystatechange',e)}else d()})}flush=function(){handler(a.takeRecords())}}
'use strict';import{nativeShadow,nativeCssVariables}from'./style-settings.js';import{parse,stringify,types,StyleNode}from'./css-parse.js';import{MEDIA_MATCH}from'./common-regex.js';import{processUnscopedStyle,isUnscopedStyle}from'./unscoped-style-handler.js';export function toCssText(a,b){return a?('string'===typeof a&&(a=parse(a)),b&&forEachRule(a,b),stringify(a,nativeCssVariables)):''}export function rulesForStyle(a){return!a.__cssRules&&a.textContent&&(a.__cssRules=parse(a.textContent)),a.__cssRules||null}export function isKeyframesSelector(a){return!!a.parent&&a.parent.type===types.KEYFRAMES_RULE}export function forEachRule(a,b,c,d){if(a){let e=!1,f=a.type;if(d&&f===types.MEDIA_RULE){let h=a.selector.match(MEDIA_MATCH);h&&!window.matchMedia(h[1]).matches&&(e=!0)}f===types.STYLE_RULE?b(a):c&&f===types.KEYFRAMES_RULE?c(a):f===types.MIXIN_RULE&&(e=!0);let g=a.rules;if(g&&!e)for(let k,h=0,j=g.length;h<j&&(k=g[h]);h++)forEachRule(k,b,c,d)}}export function applyCss(a,b,c,d){let e=createScopeStyle(a,b);return applyStyle(e,c,d),e}export function createScopeStyle(a,b){let c=document.createElement('style');return b&&c.setAttribute('scope',b),c.textContent=a,c}let lastHeadApplyNode=null;export function applyStylePlaceHolder(a){let b=document.createComment(' Shady DOM styles for '+a+' '),c=lastHeadApplyNode?lastHeadApplyNode.nextSibling:null,d=document.head;return d.insertBefore(b,c||d.firstChild),lastHeadApplyNode=b,b}export function applyStyle(a,b,c){b=b||document.head;let d=c&&c.nextSibling||b.firstChild;if(b.insertBefore(a,d),!lastHeadApplyNode)lastHeadApplyNode=a;else{let e=a.compareDocumentPosition(lastHeadApplyNode);e===Node.DOCUMENT_POSITION_PRECEDING&&(lastHeadApplyNode=a)}}export function isTargetedBuild(a){return nativeShadow?'shadow'===a:'shady'===a}export function getCssBuildType(a){return a.getAttribute('css-build')}function findMatchingParen(a,b){let c=0;for(let d=b,e=a.length;d<e;d++)if('('===a[d])c++;else if(')'===a[d]&&0===--c)return d;return-1}export function processVariableAndFallback(a,b){let c=a.indexOf('var(');if(-1===c)return b(a,'','','');let d=findMatchingParen(a,c+3),e=a.substring(c+4,d),f=a.substring(0,c),g=processVariableAndFallback(a.substring(d+1),b),h=e.indexOf(',');if(-1===h)return b(f,e.trim(),'',g);let j=e.substring(0,h).trim(),k=e.substring(h+1).trim();return b(f,j,k,g)}export function setElementClassRaw(a,b){nativeShadow?a.setAttribute('class',b):window.ShadyDOM.nativeMethods.setAttribute.call(a,'class',b)}export function getIsExtends(a){let b=a.localName,c='',d='';return b?-1<b.indexOf('-')?c=b:(d=b,c=a.getAttribute&&a.getAttribute('is')||''):(c=a.is,d=a.extends),{is:c,typeExtension:d}}export function gatherStyleText(a){const b=[],c=a.querySelectorAll('style');for(let d=0;d<c.length;d++){const e=c[d];isUnscopedStyle(e)?!nativeShadow&&(processUnscopedStyle(e),e.parentNode.removeChild(e)):(b.push(e.textContent),e.parentNode.removeChild(e))}return b.join('').trim()}
'use strict';const gulp=require('gulp'),sourcemaps=require('gulp-sourcemaps'),del=require('del'),rename=require('gulp-rename'),rollup=require('rollup-stream'),buffer=require('vinyl-buffer'),source=require('vinyl-source-stream'),closure=require('google-closure-compiler').gulp(),size=require('gulp-size'),runseq=require('run-sequence'),modules=['css-parse','custom-style-element','make-element','svg-in-shadow','style-util','style-transformer','style-settings'],moduleTasks=modules.map(a=>{return gulp.task(`test-module-${a}`,()=>{return rollup({entry:`tests/module/${a}.js`,format:'iife',moduleName:a.replace(/-/g,'_')}).pipe(source(`${a}.js`,'tests/module')).pipe(gulp.dest('./tests/module/generated'))}),`test-module-${a}`});gulp.task('clean-test-modules',()=>del(['tests/module/generated'])),gulp.task('test-modules',a=>{runseq('clean-test-modules',moduleTasks,a)});function closurify(a){return gulp.task(`closure-${a}`,()=>{return gulp.src(['src/*.js','entrypoints/*.js'],{base:'./'}).pipe(sourcemaps.init()).pipe(closure({new_type_inf:!0,compilation_level:'ADVANCED',language_in:'ES6_STRICT',language_out:'ES5_STRICT',isolation_mode:'IIFE',assume_function_wrapper:!0,js_output_file:`${a}.min.js`,entry_point:`./entrypoints/${a}.js`,dependency_mode:'STRICT',warning_level:'VERBOSE',rewrite_polyfills:!1,externs:'externs/shadycss-externs.js'})).pipe(size({showFiles:!0,showTotal:!1,gzip:!0})).pipe(sourcemaps.write('.')).pipe(gulp.dest('.'))}),`closure-${a}`}function debugify(a){return gulp.task(`debug-${a}`,()=>{return rollup({entry:`entrypoints/${a}.js`,format:'iife',moduleName:`${a}`.replace(/-/g,'_')}).pipe(source(`${a}.js`,'entrypoints')).pipe(buffer()).pipe(sourcemaps.init({loadMaps:!0})).pipe(rename(`${a}.min.js`)).pipe(size({showFiles:!0,showTotal:!1,gzip:!0})).pipe(gulp.dest('./'))}),`debug-${a}`}const entrypoints=['scoping-shim','apply-shim','custom-style-interface'];let closureTasks=entrypoints.map(a=>closurify(a)),debugTasks=entrypoints.map(a=>debugify(a));gulp.task('default',['closure','test-modules']),gulp.task('closure',a=>{runseq.apply(null,closureTasks.concat(a))}),gulp.task('debug',debugTasks);
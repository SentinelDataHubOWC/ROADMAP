var async=require("../lib/async"),expect=require("chai").expect,isBrowser=require("./support/is_browser");describe("forever",function(){context("function is asynchronous",function(){it("executes the function over and over until it yields an error",function(done){var counter=0;function addOne(callback){counter++;if(50===counter){return callback("too big!")}async.setImmediate(function(){callback()})}async.forever(addOne,function(err){expect(err).to.eql("too big!");expect(counter).to.eql(50);done()})})});context("function is synchronous",function(){it("does not cause a stack overflow",function(done){if(isBrowser())return done();var counter=0;function addOne(callback){counter++;if(5e4===counter){return callback("too big!")}callback()}async.forever(addOne,function(err){expect(err).to.eql("too big!");expect(counter).to.eql(5e4);done()})})})});